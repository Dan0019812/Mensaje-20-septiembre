<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Para Nicole ‚ù§Ô∏è Un mensaje</title>
<link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@500;700&family=Montserrat:400,600&display=swap" rel="stylesheet">
<style>
  :root{
    --bg-color: #F9EEF2;
    --accent: #d85b88;
    --soft: #f7d7e0;
    --text:#2b2b2b;
  }
  html,body{height:100%;margin:0;font-family: 'Montserrat', sans-serif;background: linear-gradient(180deg,#fff,#f9eef2);}
  .stage{
    position:relative;
    min-height:100vh;
    overflow:hidden;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:40px;
    box-sizing:border-box;
  }
  /* Background collage */
  .bg-layer{
    position:absolute;inset:0;pointer-events:none;
    background: radial-gradient(circle at 10% 20%, rgba(255,240,245,0.6), transparent 15%),
                radial-gradient(circle at 90% 80%, rgba(240,248,255,0.6), transparent 15%);
    z-index:0;
  }
  /* left pizza stylized - more centered and prominent */
  .pizza-canvas{
    position:absolute;
    left:50%;
    top:15%;
    width:400px;height:400px;
    filter: drop-shadow(0 12px 30px rgba(0,0,0,0.3));
    border-radius:20px;
    overflow:hidden;
    transform: translateX(-50%) rotate(-8deg);
    opacity:0.95;
    z-index:1;
    border: 3px solid rgba(255, 255, 255, 0.6);
  }
  /* right illustration - adjusted position */
  .couple-img{
    position:absolute;
    right:8%;
    top:12%;
    width:380px;height:380px;
    border-radius:16px;
    overflow:hidden;
    transform: rotate(6deg);
    opacity:0.85;
    box-shadow:0 12px 30px rgba(0,0,0,0.15);
    z-index:1;
  }
  /* soft frame - adjusted to work with centered image */
  .frame{
    position:relative;
    z-index:2;
    width:100%;
    max-width:960px;
    background: rgba(255,255,255,0.75);
    border-radius:18px;
    padding:36px;
    margin-top:200px;
    box-sizing:border-box;
    text-align:center;
    backdrop-filter: blur(8px) saturate(130%);
    box-shadow: 0 15px 50px rgba(0,0,0,0.15);
  }
  h1{
    font-family: 'Dancing Script', cursive;
    font-size:44px;
    margin:8px 0 12px 0;
    color:var(--accent);
    letter-spacing:0.6px;
  }
  .subtitle{color:var(--text);opacity:0.8;margin-bottom:18px;}
  .message{
    margin:18px auto 10px;
    max-width:720px;
    color:var(--text);
    font-size:20px;
    line-height:1.6;
  }
  .para{
    opacity:0;
    transform: translateY(10px);
    transition: opacity 1.6s ease, transform 1.6s ease;
    font-size:20px;
    margin:18px 0;
    font-family: 'Dancing Script', cursive;
    color:#3b2b2b;
    text-shadow: 0 1px 0 rgba(255,255,255,0.6);
  }
  .para.visible{opacity:1;transform:none;}
  /* flower petals */
  .petal{
    position:absolute;
    width:24px;height:24px;
    pointer-events:none;
    z-index:3;
    will-change:transform,opacity;
    opacity:0.95;
  }
  /* center controls */
  .controls{
    margin-top:22px;
    display:flex;
    gap:12px;
    justify-content:center;
    align-items:center;
  }
  .btn{
    background:linear-gradient(180deg,var(--accent),#c94a7a);
    color:white;padding:10px 16px;border-radius:999px;border:none;
    font-weight:600;cursor:pointer;box-shadow:0 6px 18px rgba(201,74,122,0.28);
    transition: all 0.3s ease;
  }
  .btn:hover{
    transform: translateY(-2px);
    box-shadow:0 8px 25px rgba(201,74,122,0.35);
  }
  .btn.ghost{
    background:transparent;color:var(--accent);border:2px solid rgba(216,91,136,0.4);
    box-shadow: none;
  }
  .btn.ghost:hover{
    background:rgba(216,91,136,0.1);
    border-color:var(--accent);
  }
  .btn:disabled{
    opacity:0.7;cursor:not-allowed;transform:none;
  }
  /* small footer */
  .footer{font-size:13px;color:#6b6b6b;margin-top:14px;}
  
  /* Audio visualization */
  .audio-status{
    display:inline-flex;
    align-items:center;
    gap:6px;
    font-size:12px;
    color:var(--accent);
    margin-left:8px;
  }
  .audio-wave{
    width:4px;height:12px;background:var(--accent);
    animation: wave 1.2s ease-in-out infinite;
    border-radius:2px;
  }
  .audio-wave:nth-child(2){animation-delay:0.1s;}
  .audio-wave:nth-child(3){animation-delay:0.2s;}
  .audio-wave:nth-child(4){animation-delay:0.3s;}
  
  @keyframes wave{
    0%,100%{height:8px;opacity:0.4;}
    50%{height:16px;opacity:1;}
  }
  
  /* responsive */
  @media (max-width:900px){
    .pizza-canvas{
      width:280px;height:280px;
      left:50%;
      top:8%;
      transform: translateX(-50%) rotate(-12deg);
      opacity:0.9;
    }
    .couple-img{width:220px;height:220px;right:-8%;top:6%;transform:rotate(12deg);opacity:0.8;}
    .frame{padding:22px;margin-top:150px;}
    h1{font-size:34px;}
    .para{font-size:18px;}
    .controls{flex-direction:column;gap:8px;}
  }
</style>
</head>
<body>
<div class="stage">
  <div class="bg-layer"></div>

  <!-- canvases / images for decorative backgrounds -->
  <canvas id="pizzaCanvas" class="pizza-canvas" aria-hidden="true"></canvas>
  <img id="coupleImg" class="couple-img" src="https://raw.githubusercontent.com/Dan0019812/Mensaje-20-septiembre/main/imagen mensaje1.jpg" alt="pareja ilustrada" aria-hidden="true">

  <div class="frame" role="main" aria-live="polite">
    <h1>Para Nicole</h1>
    <div class="subtitle">Un peque√±o regalo con todo mi cari√±o</div>

    <div class="message" id="messageBox" aria-atomic="true">
      <!-- paragraphs will be injected -->
      <div class="para" id="p1">S√© que tengo muchos defectos, pero lo m√°s perfecto que tengo en mi vida es a ti.</div>
      <div class="para" id="p2">Te amo much√≠simo y quiero que nunca lo dudes: t√∫ eres mi motivaci√≥n y mis ganas de ser mejor cada d√≠a.</div>
      <div class="para" id="p3">Dir√≠a que te amo con mi cabeza, pero las ideas se olvidan; tambi√©n te dir√≠a que te amo con mi coraz√≥n, pero este se muere.</div>
      <div class="para" id="p4">As√≠ que te dir√© que te amo con toda mi alma, que estar√° a tu lado d√≠a a d√≠a.</div>
    </div>

    <div class="controls">
      <button id="playBtn" class="btn">
        üéµ Reproducir m√∫sica
        <span id="audioStatus" class="audio-status" style="display:none;">
          <div class="audio-wave"></div>
          <div class="audio-wave"></div>
          <div class="audio-wave"></div>
          <div class="audio-wave"></div>
        </span>
      </button>
      <button id="fullscreenBtn" class="btn ghost">üì± Pantalla completa</button>
    </div>
    <div class="footer">La m√∫sica se reproducir√° autom√°ticamente. Si no funciona, pulsa "Reproducir m√∫sica".</div>
  </div>

  <!-- Audio element -->
  <audio id="backgroundMusic" preload="auto" loop>
    <source src="https://raw.githubusercontent.com/Dan0019812/Mensaje-20-septiembre/main/cancion.mp3" type="audio/mpeg">
    Tu navegador no soporta el elemento de audio.
  </audio>

</div>

<!-- SVG petals templates -->
<svg id="petalTemplates" style="display:none;">
  <symbol id="rose" viewBox="0 0 24 24">
    <path d="M12 2s3 2 2.5 5c0 0 2 1 2 4s-2 5-5 6-5-2-6-4 0-6 0-6S9 2 12 2z" fill="#d85b88"/>
  </symbol>
  <symbol id="tulip" viewBox="0 0 24 24">
    <path d="M12 2s3 1 4 4c0 0 2 0 3 2s-1 6-4 8-6 0-7-2 0-6 0-6S9 2 12 2z" fill="#f2a3c1"/>
  </symbol>
</svg>

<script>
/* ====== Setup images (pizza into canvas stylized) ====== */
const pizzaSrc = 'https://raw.githubusercontent.com/Dan0019812/Mensaje-20-septiembre/main/imagen mensaje2.jpg'; // pizza photo from GitHub
const pizzaCanvas = document.getElementById('pizzaCanvas');
const pctx = pizzaCanvas.getContext('2d');
const pizzaImg = new Image();
pizzaImg.crossOrigin = 'anonymous'; // Handle CORS for GitHub images
pizzaImg.src = pizzaSrc;
pizzaImg.onload = () => {
  // resize canvas to match displayed size
  const w = pizzaCanvas.clientWidth;
  const h = pizzaCanvas.clientHeight;
  pizzaCanvas.width = w;
  pizzaCanvas.height = h;
  // draw image scaled
  pctx.drawImage(pizzaImg,0,0,w,h);
  // apply cartoon filter: posterize + edge overlay
  posterize(pctx, w, h, 6);
  edgeOverlay(pctx, w, h);
};

/* Posterize function (reduce colors) */
function posterize(ctx,w,h,levels){
  const img = ctx.getImageData(0,0,w,h);
  const d = img.data;
  for(let i=0;i<d.length;i+=4){
    d[i] = Math.floor(d[i]/255*levels)/levels*255;     // r
    d[i+1] = Math.floor(d[i+1]/255*levels)/levels*255; // g
    d[i+2] = Math.floor(d[i+2]/255*levels)/levels*255; // b
    // slightly boost saturation:
    const avg = (d[i]+d[i+1]+d[i+2])/3;
    d[i] = Math.min(255, d[i] + (d[i]-avg)*0.35);
    d[i+1] = Math.min(255, d[i+1] + (d[i+1]-avg)*0.35);
    d[i+2] = Math.min(255, d[i+2] + (d[i+2]-avg)*0.35);
  }
  ctx.putImageData(img,0,0);
}

/* Simple Sobel-like edge detection overlay */
function edgeOverlay(ctx,w,h){
  const src = ctx.getImageData(0,0,w,h);
  const out = ctx.createImageData(w,h);
  const s = src.data;
  const o = out.data;
  const get = (x,y, c)=> {
    if(x<0||x>=w||y<0||y>=h) return 0;
    return s[(y*w + x)*4 + c];
  };
  for(let y=0;y<h;y++){
    for(let x=0;x<w;x++){
      // compute luminance gradients
      const gx = (
        -1*get(x-1,y-1,0) + 1*get(x+1,y-1,0)
        -2*get(x-1,y,0)   + 2*get(x+1,y,0)
        -1*get(x-1,y+1,0) + 1*get(x+1,y+1,0)
      );
      const gy = (
        -1*get(x-1,y-1,0) -2*get(x,y-1,0) -1*get(x+1,y-1,0)
         +1*get(x-1,y+1,0) +2*get(x,y+1,0) +1*get(x+1,y+1,0)
      );
      const g = Math.min(255, Math.abs(gx)+Math.abs(gy));
      const idx=(y*w+x)*4;
      // darken edges slightly
      o[idx]=s[idx]; o[idx+1]=s[idx+1]; o[idx+2]=s[idx+2]; o[idx+3]=255;
      if(g>40){
        o[idx]=Math.max(0, s[idx]-g);
        o[idx+1]=Math.max(0,s[idx+1]-g*0.7);
        o[idx+2]=Math.max(0,s[idx+2]-g*0.6);
      }
    }
  }
  ctx.putImageData(out,0,0);
}

/* ====== Petals / tulips animation ====== */
const stage = document.querySelector('.stage');
const templates = document.getElementById('petalTemplates');

function spawnPetal(kind){
  const use = document.createElementNS('http://www.w3.org/2000/svg','svg');
  use.setAttribute('class','petal');
  use.setAttribute('width','36');
  use.setAttribute('height','36');
  use.style.left = (Math.random()*100) + '%';
  use.style.top = (-10 - Math.random()*6) + '%';
  use.style.transform = `translateY(-20px) rotate(${Math.random()*360}deg)`;
  use.style.opacity = 0.95 - Math.random()*0.35;
  use.innerHTML = (kind==='rose') ? '<use href="#rose" />' : '<use href="#tulip" />';
  stage.appendChild(use);
  // animate
  const duration = 8000 + Math.random()*12000;
  const endX = (Math.random()*80)-40;
  const startLeft = parseFloat(use.style.left);
  const endLeft = startLeft + endX/ (window.innerWidth>600?1:1.5);
  use.animate([
    {transform:`translateY(0px) rotate(${Math.random()*360}deg)`, left:use.style.left, opacity:use.style.opacity},
    {transform:`translateY(${window.innerHeight + 100}px) rotate(${Math.random()*720}deg)`, left:endLeft+'%', opacity:0.05}
  ],{duration:duration, easing:'linear'});
  setTimeout(()=>use.remove(), duration+100);
}

// continuous spawner
setInterval(()=> spawnPetal(Math.random()>0.4?'rose':'tulip'), 600);

/* ====== Paragraph timings (adjusted for better flow) ====== */
const p1 = document.getElementById('p1');
const p2 = document.getElementById('p2');
const p3 = document.getElementById('p3');
const p4 = document.getElementById('p4');

// Show paragraphs progressively
setTimeout(()=>p1.classList.add('visible'), 3000);   // 3s
setTimeout(()=>p2.classList.add('visible'), 8000);   // 8s
setTimeout(()=>p3.classList.add('visible'), 13000);  // 13s
setTimeout(()=>p4.classList.add('visible'), 18000);  // 18s

// gentle pulsing of final frame
setTimeout(()=> {
  document.querySelector('.frame').style.transition='transform 2s ease';
  document.querySelector('.frame').style.transform='scale(1.02)';
  setTimeout(()=>document.querySelector('.frame').style.transform='scale(1)',1500);
}, 22000);

/* ====== Audio handling with MP3 ====== */
const playBtn = document.getElementById('playBtn');
const audioStatus = document.getElementById('audioStatus');
const backgroundMusic = document.getElementById('backgroundMusic');
let isPlaying = false;

function toggleMusic() {
  if (isPlaying) {
    backgroundMusic.pause();
    playBtn.innerHTML = 'üéµ Reproducir m√∫sica';
    audioStatus.style.display = 'none';
  } else {
    backgroundMusic.play().then(() => {
      playBtn.innerHTML = '‚è∏Ô∏è Pausar m√∫sica';
      audioStatus.style.display = 'inline-flex';
      isPlaying = true;
    }).catch(error => {
      console.log('Error reproduciendo m√∫sica:', error);
      playBtn.textContent = 'üéµ Reproducir m√∫sica (Click requerido)';
    });
  }
}

playBtn.addEventListener('click', toggleMusic);

// Auto-play attempt on load
window.addEventListener('load', () => {
  setTimeout(() => {
    backgroundMusic.play().then(() => {
      isPlaying = true;
      playBtn.innerHTML = '‚è∏Ô∏è Pausar m√∫sica';
      audioStatus.style.display = 'inline-flex';
    }).catch(() => {
      // Auto-play blocked, user will need to click
      console.log('Auto-play bloqueado, el usuario debe hacer clic');
    });
  }, 1000);
});

// Listen for music events
backgroundMusic.addEventListener('pause', () => {
  isPlaying = false;
  playBtn.innerHTML = 'üéµ Reproducir m√∫sica';
  audioStatus.style.display = 'none';
});

backgroundMusic.addEventListener('ended', () => {
  // Since it's looped, this shouldn't fire, but just in case
  isPlaying = false;
  playBtn.innerHTML = 'üéµ Reproducir m√∫sica';
  audioStatus.style.display = 'none';
});

/* fullscreen toggle */
const fsBtn = document.getElementById('fullscreenBtn');
fsBtn.addEventListener('click', ()=>{
  if(!document.fullscreenElement){
    document.documentElement.requestFullscreen().catch(()=>{});
    fsBtn.innerHTML = 'üî≤ Salir pantalla completa';
  } else {
    document.exitFullscreen();
    fsBtn.innerHTML = 'üì± Pantalla completa';
  }
});

// Listen for fullscreen changes
document.addEventListener('fullscreenchange', () => {
  if (!document.fullscreenElement) {
    fsBtn.innerHTML = 'üì± Pantalla completa';
  }
});

/* Accessibility: allow keyboard to trigger play */
document.addEventListener('keydown', (e)=>{
  if(e.key===' ' || e.key==='Enter'){
    if (e.target.tagName !== 'BUTTON') {
      e.preventDefault();
      toggleMusic();
    }
  }
});

/* Add some interaction feedback */
document.addEventListener('click', function() {
  if (!isPlaying) {
    // Try to start music on first user interaction
    backgroundMusic.play().then(() => {
      isPlaying = true;
      playBtn.innerHTML = '‚è∏Ô∏è Pausar m√∫sica';
      audioStatus.style.display = 'inline-flex';
    }).catch(() => {
      // Still blocked
    });
  }
}, { once: true });
</script>
</body>
</html>
